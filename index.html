<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Keep this so search engines don’t index while you test -->
  <meta name="robots" content="noindex,nofollow">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#2bb3b1"><!-- match teal bg -->

  <!-- Service worker -->
  <script>
    if ("serviceWorker" in navigator) {
      addEventListener("load", () => navigator.serviceWorker.register("./service-worker.js"));
    }
  </script>

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="description" content="A tiny, single-file site to run the One-Board routine (weekly wins + one action). No PHI.">
  <style>
    :root{
      --bg:#2bb3b1;          /* Median Method teal background */
      --card:#0f2138;        /* navy-slate card */
      --ink:#e6f0ff;         /* very light ink */
      --muted:#c7d5e5;       /* cool slate text */
      --accent:#2bb3b1;      /* teal (primary) */
      --accent-2:#2a91b1;    /* blue-teal (secondary) */
      --warn:#f59e0b;        /* amber */
      --danger:#dc2626;      /* red */
      --border:#1f2f46;      /* dark border */
      --border-strong:#274160;/* stronger border */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    header{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;margin-bottom:12px}
    h1{font-size:20px;margin:0;font-weight:700;letter-spacing:.3px}
    h2.kicker{margin:0 0 8px 0;font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.08em}
    .card{background:linear-gradient(180deg,#0c1e35 0%,#0a1a2f 100%);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.25)}
    .grid{display:grid;gap:12px}
    @media(min-width:900px){
      .grid-cols{grid-template-columns:2fr 1fr}
      .grid-low{grid-template-columns:2fr 1fr}
    }
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input[type="text"], input[type="date"], textarea{width:100%;border:1px solid var(--border-strong);border-radius:10px;background:#0b1f35;color:var(--ink);padding:10px 12px}
    input[type="text"]:focus, input[type="date"]:focus, textarea:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 2px rgba(43,179,177,.25)}
    textarea{min-height:64px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border-strong);background:#0b1f35;color:var(--ink);padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn:hover{border-color:#3a5575}
    /* Lighter Median Method blue "Proof" button */
    .btn.good{
      background:linear-gradient(180deg,#4f9cff,#2a91b1);
      border-color:#2a91b1;
      color:#fff;
    }
    .btn.ghost{background:transparent;border-color:transparent;color:var(--ink)}
    .pill{display:inline-flex;align-items:center;gap:6px;font-size:12px;border:1px solid var(--border);border-radius:999px;padding:6px 10px;color:var(--muted);background:#0b1f35}
    .stack{display:flex;flex-wrap:wrap;gap:8px}
    .muted{color:var(--muted)}
    .wins li{margin:6px 0}
    footer{margin-top:12px;color:var(--muted);font-size:12px;text-align:center}
    button:disabled, input:disabled, textarea:disabled, select:disabled{opacity:.6; cursor:not-allowed}

    /* Print-friendly one-pager */
    @media print{
      body{ background:#fff; color:#000; }
      .wrap{ max-width:7.5in; }
      header{ margin-bottom:8px; }
      .card{ background:#fff; border:1px solid #ccc; box-shadow:none; }
      .kicker{ color:#000 !important; }
      input, textarea{ border:none; padding:0; background:#fff; color:#000; }
      .btn, .pill, footer{ display:none !important; } /* hide chrome/buttons */
      .grid, .grid-cols, .grid-low{ gap:8px; }
    }

    /* Temporary override to confirm Option A is active */
    body{
      background:
        radial-gradient(1200px 600px at 12% -10%, rgba(43,179,177,.14), transparent 55%),
        radial-gradient(800px 400px at 95% 0, rgba(43,179,177,.08), transparent 60%),
        #0a1a2f !important;
    }
    .card{ background:#0b1f35 !important; border-color:#274160 !important; }
    .btn.good{ background:linear-gradient(180deg,#4f9cff,#2a91b1) !important; border-color:#2a91b1 !important; color:#fff !important; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>One-Board Pilot</h1>
      <div class="stack">
        <span class="pill">Week of <input id="weekOf" type="date" aria-label="Week Of" /></span>
        <span class="pill">Scribe today
          <select id="scribe" aria-label="Scribe today">
            <option>Charge AM</option>
            <option>Charge PM</option>
            <option>Room 1</option>
            <option>Room 2</option>
            <option>Float</option>
          </select>
        </span>
        <button class="btn" id="copyBtn" title="Copy a ready-to-paste weekly update">Copy Weekly Update</button>
        <button class="btn ghost" id="resetBtn" title="Clear everything for a fresh week">Reset Week</button>
        <button class="btn" id="printBtn" title="Print a one-page poster">Print Poster</button>
        <button class="btn" id="shareBtn" title="Share or copy the link">Share Link</button>
        <button class="btn" id="exportBtn" title="Download current week data">Export</button>
        <button class="btn ghost" id="importBtn" title="Load saved data">Import</button>
        <button class="btn ghost" id="clearBtn"  title="Erase local data on this device">Clear Data</button>
        <button class="btn ghost" id="lockBtn"  title="Lock/unlock kiosk">Lock</button>
        <input id="filePick" type="file" accept="application/json" style="display:none">
      </div>
    </header>

    <!-- Weekly rhythm reminder -->
    <div class="pill" style="margin-bottom:10px;background:#0b1f35;border-color:var(--border-strong)">
      Mon: set One Action • All week: add Signals • Fri: 3–5 wins, stamp Proof, post & print
    </div>

    <div class="grid grid-cols">
      <!-- Left column -->
      <section class="card">
        <h2 class="kicker">Signals — (3 short lines max)</h2>
        <div class="row">
          <div>
            <label for="signal1">Communication</label>
            <input id="signal1" type="text" placeholder="e.g., Morning update late; add 8:30a post" />
          </div>
          <div>
            <label for="signal2">Workload</label>
            <input id="signal2" type="text" placeholder="e.g., Add-ons spike 15:00–16:00" />
          </div>
        </div>
        <div style="margin-top:10px">
          <label for="signal3">Teamwork</label>
          <input id="signal3" type="text" placeholder="e.g., 2-min handoff reduced misses" />
        </div>
      </section>

      <!-- Right column -->
      <section class="card">
        <h2 class="kicker">This Week’s One Action</h2>
        <label for="oneAction">We’re trying</label>
        <input id="oneAction" type="text" placeholder="e.g., Post a daily 8:30a one-pager in #ops-updates" />
        <div class="row" style="margin-top:10px">
          <div>
            <label for="owner">Owner</label>
            <input id="owner" type="text" placeholder="e.g., Dana" />
          </div>
          <div>
            <label for="start">Starts</label>
            <input id="start" type="date" />
          </div>
        </div>
        <div class="stack" style="margin-top:10px">
          <button class="btn good" id="proofBtn">Mark Proof Done (stamps date)</button>
          <span id="proofStamp" class="muted"></span>
        </div>
      </section>
    </div>

    <div class="grid grid-low" style="margin-top:12px">
      <section class="card">
        <h2 class="kicker">Weekly Wins (3–5 bullets, Behavior → Impact)</h2>
        <div id="equityMeter" class="muted" style="margin:-4px 0 8px 0;font-size:12px"></div>
        <ol class="wins" style="padding-left:18px">
          <li><input id="win1" type="text" placeholder="@Name — covered US add-on at 15:10 → cleared backlog before shift change." /></li>
          <li><input id="win2" type="text" placeholder="@Name — labeled Probe #3 and stocked gel → first-use ready." /></li>
          <li><input id="win3" type="text" placeholder="@Name — posted 2-min handoff notes → fewer callbacks from ED." /></li>
          <li><input id="win4" type="text" placeholder="(optional)" /></li>
          <li><input id="win5" type="text" placeholder="(optional)" /></li>
        </ol>
      </section>

      <section class="card">
        <h2 class="kicker">Snapshot Notes</h2>
        <label for="topPlus">Top +1 (what improved)</label>
        <input id="topPlus" type="text" placeholder="e.g., Teamwork rose after 2-min handoff" />
        <label for="topMinus" style="margin-top:10px;display:block">Top −1 (focus area)</label>
        <input id="topMinus" type="text" placeholder="e.g., Communication: morning update timing" />
        <label for="notes" style="margin-top:10px;display:block">Notes (optional)</label>
        <textarea id="notes" placeholder="Any quick context for leaders or the team"></textarea>
      </section>
    </div>

    <footer>
      Privacy: share only aggregate results; never report subgroups with N&lt;5. No PHI in wins.
    </footer>
  </div>

  <script>
  (function(){
    const $ = id => document.getElementById(id);
    const ids = [
      'weekOf','scribe','signal1','signal2','signal3','oneAction','owner','start',
      'win1','win2','win3','win4','win5','topPlus','topMinus','notes'
    ];
    const KEY = 'one-board-pilot-v1';

    // ===== Fairness memory for Weekly Wins =====
    function recentNames(){
      try { return JSON.parse(localStorage.getItem('wins-names')) || []; }
      catch(e){ return []; }
    }
    function saveNames(list){
      localStorage.setItem('wins-names', JSON.stringify(list.slice(-14)));
    }

    // ===== Load / Save =====
    function load(){
      try{
        const raw = localStorage.getItem(KEY);
        if(!raw) return;
        const data = JSON.parse(raw);
        ids.forEach(id=>{ if(data[id]!==undefined && $(id)) $(id).value = data[id]; });
        if(data.proofStamp){ $('proofStamp').textContent = 'Proof: ' + data.proofStamp; }
      }catch(e){ console.warn('Load failed', e); }
    }
    function save(){
      const data = {};
      ids.forEach(id=> data[id] = ($(id)?.value || '').trim());
      data.proofStamp = $('proofStamp').textContent || '';
      try{ localStorage.setItem(KEY, JSON.stringify(data)); }catch(e){ console.warn('Save failed', e); }
    }

    // ===== Reset & Proof =====
    function resetWeek(){
      if(!confirm('Clear all fields for a fresh week?')) return;
      ids.forEach(id=> { if($(id)) $(id).value = ''; });
      $('proofStamp').textContent='';
      save();
      updateEquityMeter();
    }
    function stampProof(){
      const now = new Date();
      const stamp = now.toLocaleDateString() + ' ' + now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
      $('proofStamp').textContent = 'DONE — ' + stamp;
      save();
    }

    // ===== Weekly Update copy + fairness nudge =====
    function copyWeekly(){
      const week = $('weekOf').value || '(set week)';
      const tp = $('topPlus').value; const tm = $('topMinus').value;
      const act = $('oneAction').value; const owner = $('owner').value; const start = $('start').value;
      const wins = [1,2,3,4,5].map(n => $('win'+n).value).filter(Boolean).slice(0,5);

      // fairness nudge: warn if a name repeated within last 14 entries
      const names = wins.map(w => (w.match(/@(\S+)/)||[])[1]).filter(Boolean);
      const last = recentNames();
      const repeats = names.filter(n => last.includes(n));
      if (repeats.length){
        alert('Heads up: recent repeat(s): ' + [...new Set(repeats)].map(n=>'@'+n).join(', '));
      }
      saveNames(last.concat(names));

      const lines = [];
      lines.push(`Weekly Pulse Snapshot — Week of ${week}`);
      if(tp) lines.push(`Top +1: ${tp}`);
      if(tm) lines.push(`Top −1: ${tm}`);
      if(act){
        lines.push(`One action (this week): ${act}` + (owner?` (owner: ${owner}`:'') + (start?`, starts: ${start}`:'') + (owner||start?')':''));
      }
      if(wins.length){
        lines.push('');
        lines.push('Weekly Wins');
        wins.forEach(w=> lines.push(`• ${w}`));
      }
      const txt = lines.join('\n');
      navigator.clipboard.writeText(txt).then(()=>{
        $('copyBtn').textContent = 'Copied!';
        setTimeout(()=> $('copyBtn').textContent = 'Copy Weekly Update', 1400);
      }).catch(()=>{
        alert('Copy failed — your browser may block clipboard writes. You can still select & copy manually.');
      });

      updateEquityMeter();
    }

    // ===== Equity meter (unique names this week) =====
    function updateEquityMeter(){
      const wins = [1,2,3,4,5].map(n => $('win'+n).value).filter(Boolean);
      const names = wins.map(w => (w.match(/@(\S+)/)||[])[1]).filter(Boolean);
      const uniq = new Set(names).size;
      $('equityMeter').textContent = wins.length ? `Recognition equity: ${uniq} unique name(s) this week` : '';
    }

    // ===== Export / Import / Clear =====
    function exportData(){
      const raw = localStorage.getItem(KEY) || "{}";
      const blob = new Blob([raw], {type:"application/json"});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `one-board-${($('weekOf').value||'week')}.json`;
      a.click(); URL.revokeObjectURL(a.href);
    }
    function importData(){ $('filePick').click(); }
    $('filePick').addEventListener('change', e=>{
      const f = e.target.files[0]; if(!f) return;
      const r = new FileReader();
      r.onload = () => { try { localStorage.setItem(KEY, r.result); load(); updateEquityMeter(); } catch(e){ alert('Import failed (bad file)'); } };
      r.readAsText(f);
      e.target.value = '';
    });
    function clearData(){
      if(confirm('Erase local data on this device?')){
        localStorage.removeItem(KEY);
        localStorage.removeItem('wins-names');
        location.reload();
      }
    }

    // ===== Kiosk Lock (PIN) =====
    let LOCKED = (localStorage.getItem('one-board-locked') === '1');
    let PIN = localStorage.getItem('one-board-pin') || '';
    function setLocked(flag){
      LOCKED = flag;
      localStorage.setItem('one-board-locked', flag ? '1' : '0');
      const ctrls = document.querySelectorAll('input, textarea, button, select');
      ctrls.forEach(el=>{
        // Keep these usable while locked:
        if(['lockBtn','printBtn','shareBtn'].includes(el.id)) return;
        el.disabled = flag;
      });
      $('lockBtn').textContent = flag ? 'Unlock' : 'Lock';
    }
    function toggleLock(){
      if(!LOCKED){
        if(!PIN){
          PIN = prompt('Set a 4-digit PIN to lock/unlock:', '') || '';
          if(!PIN) return;
          localStorage.setItem('one-board-pin', PIN);
        }
        setLocked(true);
      }else{
        const tryPin = prompt('Enter PIN to unlock:', '');
        if(tryPin === PIN) setLocked(false); else alert('Wrong PIN');
      }
    }

    // ===== Share Link =====
    async function shareLink(){
      const url = location.href;
      if (navigator.share) {
        try { await navigator.share({ title:'One-Board', url }); } catch(e){}
      } else {
        await navigator.clipboard.writeText(url);
        alert('Link copied:\n' + url);
      }
    }

    // ===== Wire up events =====
    ids.forEach(id => { const el=$(id); if(el) el.addEventListener('input', () => { save(); if(id.startsWith('win')) updateEquityMeter(); }); });
    $('proofBtn').addEventListener('click', stampProof);
    $('resetBtn').addEventListener('click', resetWeek);
    $('copyBtn').addEventListener('click', copyWeekly);
    $('printBtn').addEventListener('click', () => window.print());
    $('shareBtn').addEventListener('click', shareLink);
    $('exportBtn').addEventListener('click', exportData);
    $('importBtn').addEventListener('click', importData);
    $('clearBtn').addEventListener('click', clearData);
    $('lockBtn').addEventListener('click', toggleLock);

    // ===== Init =====
    load();
    updateEquityMeter();
    setLocked(LOCKED);
  })();
  </script>
  
</body>
</html>
